<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>TubExtractor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@100;200;300;400;500;600;700;800;900&family=DM+Sans:wght@100;200;300;400;500;600;700;800;900&subset=latin&display=swap" rel="stylesheet" id="sf-google-fonts">
  <!--font Style -->
  <style>
    body.font-family {
      font-family: 'DM Sans', sans-serif;
    }
    .btn-pink-moon {
    background: #ec008c;  /* fallback for old browsers */
    background: -webkit-linear-gradient(to right, #fc6767, #ec008c);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(to right, #fc6767, #ec008c); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
    color: #fff;
    }
    .btn-pink-moon:hover {
      background: #A770EF;  /* fallback for old browsers */
    background: -webkit-linear-gradient(145deg, #FDB99B, #CF8BF3, #A770EF);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(145deg, #FDB99B, #CF8BF3, #A770EF); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
    color: #fff;
    }
    .col-12 {
    max-width: 100%;
  }
  
  </style>
  
</head>

<body class="font-family">
  <section class="text-center">
    <div class="container p-1 mb-5">
      <div class="row justify-content-center text-md-center">
        <div class="col-lg-10 col-xl-8 mb-0">
          <img src="{{ url_for('static', filename='img/tubextractor.png') }}" alt="logo Tubextractor" width="200px">
          <h1>
            TubExtractor
          </h1>
        </div>
        <div class="col-md-9 col-lg-7 col-xl-6 col-xxl-5 mb-10">
          
          <p class="lead mb-3" data-aos="fade-down" data-aos-delay="150">
            Whether you need the video transcript, tags, or even the video title and channel information, TubExtractor has got you covered.
            <span class="text-nowrap"></span>
          </p>
        </div>
      </div>
      <form method="post" enctype="multipart/form-data" class="js-ajax-form mb-10">
        {{ form.hidden_tag() }}
        <div class="row justify-content-center text-md-center">
            <div class="col-md-6 col-lg-8 col-xl-6">
                <div class="input-group mb-2">
                    {{ form.video_id(class="form-control form-control-lg", placeholder="Enter the video URL", required="required") }}
                </div>
            </div>
            <div class="col-md-6 col-lg-4 col-xl-2">
                {{ form.submit(class="btn btn-pink-moon btn-lg btn-block w-100") }}
            </div>
        </div>
    </form>
      <div id="loader" style="display: none;">
        <br><br>
        <p class="h4 mb-3">loading...</p>
      </div>
    
      </div>
    </section>
<br>
      <section id="video-info" style="display: none;">
        <div class="container bg-dark text-light p-5 rounded-3">
          <div class="row mb-5">
            <div class="col-sm-8 col-lg-4 mb-3">
              <img id="thumbnail-img" src="" alt="video Thumbnail">
              </div>
            <div  class="col-sm-4 col-lg-8"> 
              <h2 id="video-title" class="h3 mb-12 w-100"></h2>
              <p id="channel-title"></p>
              <p class="mb-2"><strong>Duration:</strong> <span id="video-duration-value"></span></p>
              <select id="format-select" class="form-select p-3">
                {% for format in video_info.formats %}
                <option value="{{ format.format_id }}">{{ format.ext }} - {{ format.format_note }}</option>
                {% endfor %}
              </select>
              <br>
              <button id="download-button" class="btn btn-pink-moon btn-lg btn-block w-100 p-3">
                <i class="fas fa-download"></i> Download
            </button>
            <div id="loading-message" style="display: none;">
              <p>loading...</p>
          </div>
                  </section>
             

          <!-- Add this section for the textarea -->
          
          <section class="m-5" id="video-info2" style="display: none;">
            <div class="row m-5 justify-content-center">
              <div class="col-md-6 col-sm-12 text-center mb-3">
                <img src="{{ url_for('static', filename='img/paper-writing.svg') }}" alt="icon transcript Tubextractor" width="64px" class="mb-3">
                <textarea id="transcription-textarea" class="form-control mb-2 w-100" rows="5"></textarea>
                <button class="btn btn-pink-moon w-100 p-3" id="copy-transcription-btn">Copy Transcript</button>
              </div>
              <div class="col-md-6 col-sm-12 text-center">
                <img src="{{ url_for('static', filename='img/tags.svg') }}" alt="icon tags Tubextractor" width="64px" class="mb-3">
                <textarea id="tags-textarea" class="form-control mb-2 w-100" rows="5"></textarea>
                <button class="btn btn-pink-moon w-100 p-3" id="copy-tags-btn">Copy Tags</button>
              </div>
            </div>
          </section>
          <!-- Add section for audio download-->
          <section id="audio-info" style="display: none;">
            <div class="container bg-light text-dark p-5 rounded-3">
              <div class="row mb-5">
                <div class="col-sm-8 col-lg-4 mb-3">
                  <img src="{{ url_for('static', filename='img/tubextractor_video_to_mp3.png') }}" alt="icon tags Tubextractor" width="300px" class="mb-3">
                                  </div>
                <div  class="col-sm-4 col-lg-8"> 
                  <h2 class="h3 mb-12 w-100"> Video to mp3</h2>
                  <p class="lead mb-3">Testo che inviti allo scaricamento del file audio</p>
                     <a href="/download_audio" download>
                      <button id="download-audio" class="btn btn-pink-moon btn-lg btn-block w-100 p-3">
                        <i class="fas fa-download"></i> Download MP3
                    </button>
                </a><br>
                <p id="loading-message-audio" style="display: none;">Loading...</p>
       </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"
    data-integrity="38d870e9c3c4e532551b530706abb811"></script>

  <!-- Custom script -->
  <script>
    function get_youtube_video_id(url) {
        var video_id = url.split('v=')[1];
        var ampersandPosition = video_id.indexOf('&');
        if (ampersandPosition != -1) {
            video_id = video_id.substring(0, ampersandPosition);
        }
        return video_id;
    }

    document.querySelector('.js-ajax-form').addEventListener('submit', function (event) {
        event.preventDefault();

        // Clear the results from the previous search
        document.querySelector('#transcription-textarea').value = '';
        document.querySelector('#tags-textarea').value = '';

        var loader = document.querySelector('#loader');
        var loadingMessage = document.querySelector('#loading-message');
        var downloadButton = document.querySelector('#download-button');
        loader.style.display = 'block';
        loadingMessage.style.display = 'none'; // Hide the loading message
        downloadButton.disabled = true;

        var videoUrl = document.querySelector('input[name="video_id"]').value;
        var videoId = get_youtube_video_id(videoUrl);

        fetch('/get_video_info', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({video_id: videoId})
        })
            .then(function (response) {
                loader.style.display = 'none';
                downloadButton.disabled = false; // Enable the download button
                return response.json();
            })
            .then(function (data) {
                var durationValueElement = document.querySelector('#video-duration-value');
                durationValueElement.textContent = data.duration; // Set the duration value

                var transcriptionTextarea = document.querySelector('#transcription-textarea');
                var tagsTextarea = document.querySelector('#tags-textarea');
                transcriptionTextarea.value = data.transcript;
                tagsTextarea.value = data.tags.join(', ');
                document.querySelector('#video-title').textContent = data.title;
                document.querySelector('#channel-title').textContent = 'POSTED BY: ' + data.channel_title;
                document.querySelector('#thumbnail-img').src = data.thumbnail;

               // Populate the formats dropdown
                var formatSelect = document.querySelector('#format-select');
                formatSelect.innerHTML = '';
                for (var i = 0; i < data.formats.length; i++) {
                    var formatOption = document.createElement('option');
                    formatOption.value = data.formats[i].format_id;
                    formatOption.textContent = data.formats[i].ext + ' - ' + data.formats[i].format_note;
                    var iconElement = document.createElement('i');
                    iconElement.classList.add('fas', 'fa-video');
                    formatOption.appendChild(iconElement);
                    formatSelect.appendChild(formatOption);
                }

                // Add the download button's click event
                downloadButton.addEventListener('click', function () {
                    // Get the selected format
                    var selectedFormat = document.querySelector('#format-select').value;
                    // Show the loading message
                    loadingMessage.style.display = 'block';
                    downloadButton.disabled = true; // Disable the download button during the download process
                    // Redirect to the download URL
                    window.location.href = '/download_video/' + selectedFormat + '?video_id=' + videoId;
                    // Enable the download button after a short delay (adjust the delay as needed)
                    setTimeout(function () {
                        loadingMessage.style.display = 'none'; // Hide the loading message after the download
                        downloadButton.disabled = false;
                    }, 1000);
                });

                // Show the results section
                document.querySelector('#video-info').style.display = 'block';
                document.querySelector('#video-info2').style.display = 'block';
                document.querySelector('#audio-info').style.display = 'block';

                // Clear the form for a new search
                document.querySelector('.js-ajax-form').reset();
            })
            .catch(function (error) {
                console.log('Error during fetch:', error);
                loader.style.display = 'none';
                loadingMessage.style.display = 'none'; // Hide the loading message in case of error
                downloadButton.disabled = false; // Enable the download button in case of error
            });
    });

    // Add the event listeners for copying the transcript and tags
    document.querySelector('#copy-transcription-btn').addEventListener('click', function () {
        var transcriptionText = document.querySelector('#transcription-textarea').value;
        copyToClipboard(transcriptionText);
    });

    document.querySelector('#copy-tags-btn').addEventListener('click', function () {
        var tagsText = document.querySelector('#tags-textarea').value;
        copyToClipboard(tagsText);
    });

    // Utility function for copying text to clipboard
    function copyToClipboard(text) {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Text copied to clipboard!');
    }
 // Add the event listeners for audio
    document.querySelector('#download-audio').addEventListener('click', function () {
    document.querySelector('#loading-message-audio').style.display = 'block';
});

</script>





</body>
</html>
